<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML to Go Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <style>
      /* 自定义滚动条样式 */
      .monaco-editor .scrollbar {
        width: 10px !important;
      }
      .monaco-editor .scrollbar .slider {
        background: rgba(255, 255, 255, 0.1) !important;
        border-radius: 5px !important;
      }
      .monaco-editor .scrollbar .slider:hover {
        background: rgba(255, 255, 255, 0.2) !important;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <header class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
          HTML to Go Converter
        </h1>
        <p class="text-gray-600">将HTML代码转换为Go的htmlgo包代码</p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- HTML输入部分 -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">HTML 输入</h2>
          <div
            id="htmlEditor"
            class="h-96 border rounded-lg overflow-hidden"
          ></div>
        </div>

        <!-- Go输出部分 -->
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">Go 代码输出</h2>
          <div
            id="goEditor"
            class="h-96 border rounded-lg overflow-hidden"
          ></div>
        </div>
      </div>

      <!-- 转换选项和按钮 -->
      <div class="text-center mt-8 space-y-4">
        <!-- 包前缀配置 -->
        <div class="flex items-center justify-center space-x-4">
          <div class="relative">
            <input
              type="text"
              id="packagePrefix"
              placeholder="包前缀（可选）"
              class="w-48 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
              <button
                onclick="clearPrefix()"
                class="text-gray-400 hover:text-gray-600 focus:outline-none"
                title="清除前缀"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>
          </div>
          <button
            onclick="convertHTML()"
            class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-8 rounded-lg transition duration-300 transform hover:scale-105"
          >
            转换代码
          </button>
        </div>
      </div>

      <!-- 示例代码部分 -->
      <div class="mt-12">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">示例代码</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- 示例1 -->
          <div
            class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg transition duration-300"
            onclick="loadExample(1)"
          >
            <h3 class="font-semibold text-gray-700 mb-2">基础示例</h3>
            <pre
              class="text-sm text-gray-600 bg-gray-50 p-2 rounded"
            ><code>&lt;div class="container"&gt;Hello&lt;/div&gt;</code></pre>
          </div>
          <!-- 示例2 -->
          <div
            class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg transition duration-300"
            onclick="loadExample(2)"
          >
            <h3 class="font-semibold text-gray-700 mb-2">嵌套元素</h3>
            <pre
              class="text-sm text-gray-600 bg-gray-50 p-2 rounded"
            ><code>&lt;div class="container"&gt;
  &lt;h1 class="title"&gt;Hello&lt;/h1&gt;
  &lt;p class="text"&gt;World&lt;/p&gt;
&lt;/div&gt;</code></pre>
          </div>
          <!-- 示例3 -->
          <div
            class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg transition duration-300"
            onclick="loadExample(3)"
          >
            <h3 class="font-semibold text-gray-700 mb-2">表单元素</h3>
            <pre
              class="text-sm text-gray-600 bg-gray-50 p-2 rounded"
            ><code>&lt;input type="text" class="input" placeholder="Enter text" required&gt;</code></pre>
          </div>
          <!-- 示例4：Vue组件 -->
          <div
            class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg transition duration-300"
            onclick="loadExample(4)"
          >
            <h3 class="font-semibold text-gray-700 mb-2">Vue组件</h3>
            <pre
              class="text-sm text-gray-600 bg-gray-50 p-2 rounded"
            ><code>&lt;div class="app"&gt;
  &lt;h1 v-if="showTitle" class="title"&gt;{{ title }}&lt;/h1&gt;
  &lt;ul class="list"&gt;
    &lt;li v-for="item in items" :key="item.id" @click="selectItem(item)" class="item"&gt;
      {{ item.name }}
    &lt;/li&gt;
  &lt;/ul&gt;
  &lt;input v-model="newItem" type="text" class="input" placeholder="Add new item"&gt;
  &lt;button @click="addItem" class="btn"&gt;Add&lt;/button&gt;
&lt;/div&gt;</code></pre>
          </div>
        </div>
      </div>
    </div>

    <script>
      let htmlEditor, goEditor

      // 定义One Dark Pro主题
      const oneDarkPro = {
        base: 'vs-dark',
        inherit: true,
        rules: [
          { token: 'comment', foreground: '5c6370', fontStyle: 'italic' },
          { token: 'keyword', foreground: 'c678dd' },
          { token: 'string', foreground: '98c379' },
          { token: 'number', foreground: 'd19a66' },
          { token: 'type', foreground: '61afef' },
          { token: 'function', foreground: '61afef' },
          { token: 'variable', foreground: 'e06c75' },
          { token: 'constant', foreground: 'd19a66' },
        ],
        colors: {
          'editor.background': '#282c34',
          'editor.foreground': '#abb2bf',
          'editor.lineHighlightBackground': '#2c313c',
          'editorCursor.foreground': '#528bff',
          'editorWhitespace.foreground': '#3b4048',
          'editorIndentGuide.background': '#3b4048',
          'editor.selectionBackground': '#3e4451',
          'editor.inactiveSelectionBackground': '#3e4451',
        },
      }

      // 初始化Monaco编辑器
      require.config({
        paths: {
          vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs',
        },
      })

      require(['vs/editor/editor.main'], function () {
        // 注册One Dark Pro主题
        monaco.editor.defineTheme('oneDarkPro', oneDarkPro)

        // 创建HTML编辑器
        htmlEditor = monaco.editor.create(
          document.getElementById('htmlEditor'),
          {
            value: '',
            language: 'html',
            theme: 'vs-light',
            minimap: { enabled: false },
            automaticLayout: true,
            fontSize: 14,
            lineHeight: 21,
            padding: { top: 16, bottom: 16 },
          }
        )

        // 创建Go编辑器
        goEditor = monaco.editor.create(document.getElementById('goEditor'), {
          value: '',
          language: 'go',
          theme: 'oneDarkPro',
          minimap: { enabled: false },
          readOnly: true,
          automaticLayout: true,
          formatOnPaste: true,
          formatOnType: true,
          wordWrap: 'on',
          lineNumbers: 'on',
          renderWhitespace: 'selection',
          scrollBeyondLastLine: false,
          fontSize: 14,
          lineHeight: 21,
          tabSize: 2,
          padding: { top: 16, bottom: 16 },
          renderIndentGuides: true,
          bracketPairColorization: { enabled: true },
          guides: {
            bracketPairs: true,
            indentation: true,
          },
        })

        // 设置编辑器默认值
        goEditor.setValue(
          '// 转换后的Go代码将显示在这里\n// 使用One Dark Pro主题'
        )
      })

      // 示例代码
      const examples = {
        1: '<div class="container">Hello</div>',
        2: '<div class="container">\n  <h1 class="title">Hello</h1>\n  <p class="text">World</p>\n</div>',
        3: '<input type="text" class="input" placeholder="Enter text" required>',
        4: '<div class="app">\n  <h1 v-if="showTitle" class="title">{{ title }}</h1>\n  <ul class="list">\n    <li v-for="item in items" :key="item.id" @click="selectItem(item)" class="item">{{ item.name }}</li>\n  </ul>\n  <input v-model="newItem" type="text" class="input" placeholder="Add new item">\n  <button @click="addItem" class="btn">Add</button>\n</div>',
      }

      // 加载示例代码
      function loadExample(id) {
        if (htmlEditor) {
          htmlEditor.setValue(examples[id])
        }
      }

      // 清除包前缀
      function clearPrefix() {
        document.getElementById('packagePrefix').value = ''
      }

      // 转换代码
      async function convertHTML() {
        const htmlInput = htmlEditor.getValue()
        const packagePrefix = document
          .getElementById('packagePrefix')
          .value.trim()

        try {
          const response = await fetch('/convert', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              html: htmlInput,
              packagePrefix: packagePrefix,
            }),
          })

          if (!response.ok) {
            throw new Error(await response.text())
          }

          const data = await response.json()

          // 只设置Go代码，不触发编辑器的格式化
          goEditor.setValue(data.code)
        } catch (error) {
          goEditor.setValue('错误: ' + error.message)
        }
      }
    </script>
  </body>
</html>
